<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä¸‡èƒ½æ–‡ä»¶è½¬ .123 å·¥å…·</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f4f6f8;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            padding: 20px;
            box-sizing: border-box;
        }
        .container {
            background-color: white;
            padding: 2.5rem;
            border-radius: 16px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            width: 500px;
            max-width: 100%;
        }
        h2 {
            text-align: center;
            color: #2c3e50;
            margin-top: 0;
            margin-bottom: 2rem;
            font-weight: 600;
        }
        
        /* éšè—åŸç”Ÿçš„ä¸‘é™‹ file input */
        input[type="file"] {
            display: none;
        }

        /* è‡ªå®šä¹‰çš„å¤§æŒ‰é’®æ ·å¼ */
        .upload-box {
            border: 2px dashed #bdc3c7;
            border-radius: 12px;
            padding: 40px 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            background-color: #fafbfc;
            margin-bottom: 15px;
            position: relative;
        }
        .upload-box:hover {
            border-color: #3498db;
            background-color: #ecf6fc;
            transform: translateY(-2px);
        }
        .upload-box.active {
            border-color: #2ecc71;
            background-color: #f0fff4;
        }
        
        .icon {
            font-size: 40px;
            display: block;
            margin-bottom: 10px;
            color: #3498db;
        }
        .box-title {
            font-size: 1.1rem;
            font-weight: bold;
            color: #34495e;
            display: block;
        }
        .box-desc {
            font-size: 0.85rem;
            color: #7f8c8d;
            margin-top: 5px;
            display: block;
        }

        /* é€‰å¥½æ–‡ä»¶åçš„æç¤º */
        .file-info {
            font-size: 0.9rem;
            color: #27ae60;
            margin-bottom: 15px;
            text-align: center;
            font-weight: 500;
            min-height: 1.2em;
        }

        /* æŒ‰é’® */
        .action-btn {
            width: 100%;
            padding: 14px;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: background 0.3s;
            color: white;
            margin-bottom: 30px; /* å¢åŠ ä¸¤ä¸ªåŒºåŸŸçš„é—´è· */
        }
        .btn-blue { background-color: #3498db; box-shadow: 0 4px 10px rgba(52, 152, 219, 0.3); }
        .btn-blue:hover { background-color: #2980b9; }
        
        .btn-green { background-color: #2ecc71; box-shadow: 0 4px 10px rgba(46, 204, 113, 0.3); }
        .btn-green:hover { background-color: #27ae60; }

        .btn-disabled {
            background-color: #95a5a6;
            cursor: not-allowed;
            box-shadow: none;
        }

        .section-label {
            font-size: 0.85rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: #95a5a6;
            margin-bottom: 10px;
            display: block;
            font-weight: bold;
        }

        .status-msg {
            text-align: center;
            font-size: 0.9rem;
            color: #e67e22;
            margin-bottom: 10px;
        }
    </style>
</head>
<body>

    <div class="container">
        <h2>ğŸ“¦ ä¸‡èƒ½æ–‡ä»¶è½¬ .123</h2>

        <div>
            <span class="section-label">æ¨¡å¼ A: ä»»æ„æ–‡ä»¶ä¸€å¯¹ä¸€</span>
            
            <label for="filesInput" class="upload-box" id="boxA">
                <span class="icon">ğŸ“„</span>
                <span class="box-title">ç‚¹å‡»é€‰æ‹©ä»»æ„æ–‡ä»¶</span>
                <span class="box-desc">æ”¯æŒå¤šé€‰ï¼Œä¸é™æ ¼å¼ (å›¾ç‰‡/è§†é¢‘/æ–‡æ¡£ç­‰)</span>
            </label>
            <input type="file" id="filesInput" multiple onchange="updateFileInfo('filesInput', 'infoA', 'boxA')">
            
            <div id="infoA" class="file-info">æœªé€‰æ‹©æ–‡ä»¶</div>
            
            <button class="action-btn btn-blue" id="btnBatch" onclick="handleBatchFiles()">â¬‡ï¸ æ‰¹é‡ç‹¬ç«‹å‹ç¼©ä¸‹è½½</button>
            <div id="statusBatch" class="status-msg"></div>
        </div>

        <hr style="border:0; border-top:1px solid #eee; margin: 0 0 30px 0;">

        <div>
            <span class="section-label">æ¨¡å¼ B: æ–‡ä»¶å¤¹æ•´ä½“æ‰“åŒ…</span>
            
            <label for="folderInput" class="upload-box" id="boxB">
                <span class="icon">ğŸ“</span>
                <span class="box-title">ç‚¹å‡»é€‰æ‹©æ–‡ä»¶å¤¹</span>
                <span class="box-desc">ä¿ç•™ç›®å½•ç»“æ„ï¼Œæ•´åŒ…ä¸‹è½½</span>
            </label>
            <input type="file" id="folderInput" webkitdirectory onchange="updateFileInfo('folderInput', 'infoB', 'boxB')">
            
            <div id="infoB" class="file-info">æœªé€‰æ‹©æ–‡ä»¶å¤¹</div>
            
            <button class="action-btn btn-green" id="btnFolder" onclick="handleFolder()">â¬‡ï¸ æ‰“åŒ…æ–‡ä»¶å¤¹ä¸‹è½½</button>
            <div id="statusFolder" class="status-msg"></div>
        </div>

    </div>

    <script>
        // æ›´æ–°æ˜¾ç¤ºé€‰ä¸­äº†å¤šå°‘ä¸ªæ–‡ä»¶
        function updateFileInfo(inputId, infoId, boxId) {
            const input = document.getElementById(inputId);
            const info = document.getElementById(infoId);
            const box = document.getElementById(boxId);
            
            if (input.files.length > 0) {
                if(inputId === 'folderInput') {
                    // æ–‡ä»¶å¤¹æ¨¡å¼é€šå¸¸æ–‡ä»¶å¾ˆå¤šï¼Œæ˜¾ç¤ºæ€»æ•°
                    info.innerText = `å·²é€‰ä¸­æ–‡ä»¶å¤¹ï¼ŒåŒ…å« ${input.files.length} ä¸ªæ–‡ä»¶`;
                } else {
                    info.innerText = `å·²é€‰ä¸­ ${input.files.length} ä¸ªæ–‡ä»¶`;
                }
                box.classList.add('active');
            } else {
                info.innerText = "æœªé€‰æ‹©æ–‡ä»¶";
                box.classList.remove('active');
            }
        }

        // é€šç”¨ä¸‹è½½
        function downloadBlob(blob, filename) {
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = filename;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        // --- æ¨¡å¼ A é€»è¾‘ ---
        async function handleBatchFiles() {
            const input = document.getElementById('filesInput');
            const status = document.getElementById('statusBatch');
            const btn = document.getElementById('btnBatch');

            if (input.files.length === 0) {
                alert("è¯·å…ˆç‚¹å‡»ä¸Šæ–¹çš„å¤§æ–¹æ¡†é€‰æ‹©æ–‡ä»¶ï¼");
                return;
            }

            // æç¤ºç”¨æˆ·å…è®¸å¤šæ–‡ä»¶ä¸‹è½½
            if (input.files.length > 1) {
                status.innerText = "âš ï¸ å¦‚ä¸‹è½½è¢«æ‹¦æˆªï¼Œè¯·åœ¨åœ°å€æ å…è®¸ä¸‹è½½å¤šä¸ªæ–‡ä»¶";
            }

            btn.disabled = true;
            btn.classList.add('btn-disabled');
            
            try {
                for (let i = 0; i < input.files.length; i++) {
                    const file = input.files[i];
                    
                    const zip = new JSZip();
                    zip.file(file.name, file); // æ”¾å…¥ ZIP

                    const content = await zip.generateAsync({ type: "blob" });

                    // è·å–ä¸å¸¦åç¼€çš„æ–‡ä»¶å
                    let baseName = file.name;
                    // å¦‚æœæ–‡ä»¶åé‡Œæœ‰ . åˆ™å»æ‰æœ€åä¸€ä¸ª . åŠå…¶åé¢çš„å†…å®¹
                    if(baseName.lastIndexOf('.') > 0) {
                        baseName = baseName.substring(0, baseName.lastIndexOf('.'));
                    }
                    
                    const finalName = baseName + ".123";

                    downloadBlob(content, finalName);
                    
                    // ç¨å¾®ç­‰å¾…ï¼Œé¿å…æµè§ˆå™¨å¡æ­»
                    await new Promise(r => setTimeout(r, 300));
                }
                status.innerText = "âœ… æ‰€æœ‰æ–‡ä»¶å¤„ç†å®Œæ¯•ï¼";
            } catch (err) {
                console.error(err);
                status.innerText = "âŒ å‡ºé”™: " + err.message;
            } finally {
                btn.disabled = false;
                btn.classList.remove('btn-disabled');
            }
        }

        // --- æ¨¡å¼ B é€»è¾‘ ---
        async function handleFolder() {
            const input = document.getElementById('folderInput');
            const status = document.getElementById('statusFolder');
            const btn = document.getElementById('btnFolder');

            if (input.files.length === 0) {
                alert("è¯·å…ˆç‚¹å‡»æ–‡ä»¶å¤¹å›¾æ ‡é€‰æ‹©æ–‡ä»¶å¤¹ï¼");
                return;
            }

            btn.disabled = true;
            btn.classList.add('btn-disabled');
            status.innerText = "â³ æ­£åœ¨å‹ç¼©ï¼Œè¯·ç¨å€™...";

            try {
                const zip = new JSZip();
                
                // æ™ºèƒ½è·å–æ–‡ä»¶å¤¹å
                let folderName = "folder_archive";
                if (input.files[0].webkitRelativePath) {
                    const parts = input.files[0].webkitRelativePath.split('/');
                    if (parts.length > 0) folderName = parts[0];
                }

                for (let i = 0; i < input.files.length; i++) {
                    const file = input.files[i];
                    zip.file(file.webkitRelativePath, file);
                }

                const content = await zip.generateAsync({ type: "blob" });
                const finalName = folderName + ".123";
                
                downloadBlob(content, finalName);
                status.innerText = "âœ… ä¸‹è½½å·²å¼€å§‹ï¼";

            } catch (err) {
                console.error(err);
                status.innerText = "âŒ å‡ºé”™: " + err.message;
            } finally {
                btn.disabled = false;
                btn.classList.remove('btn-disabled');
            }
        }
    </script>
</body>
</html>