<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ–‡ä»¶è½¬ .123 å·¥å…· (ä¿®å¤ç‰ˆ)</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <style>
        /* --- 1. å…¨å±€é‡ç½® (ä¿®å¤ç•Œé¢é”™ä¹±çš„æ ¸å¿ƒ) --- */
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            background-color: #f0f2f5;
            color: #333;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            padding: 20px;
        }

        /* --- 2. ä¸»å®¹å™¨æ ·å¼ --- */
        .card {
            background: white;
            width: 100%;
            max-width: 480px; /* é™åˆ¶æœ€å¤§å®½åº¦ï¼Œé˜²æ­¢å¤ªå®½ */
            border-radius: 12px;
            box-shadow: 0 8px 24px rgba(0,0,0,0.12);
            padding: 30px;
            text-align: center;
        }

        h2 {
            margin-bottom: 25px;
            font-size: 1.5rem;
            color: #1a1a1a;
            font-weight: 700;
        }

        /* --- 3. ä¸¤ä¸ªåŒºåŸŸçš„åˆ†éš”çº¿ --- */
        .divider {
            height: 1px;
            background-color: #e1e4e8;
            margin: 30px 0;
            border: none;
        }

        /* --- 4. ä¸Šä¼ åŒºåŸŸæ ·å¼ --- */
        .section-title {
            text-align: left;
            font-size: 0.9rem;
            font-weight: 700;
            color: #666;
            margin-bottom: 10px;
            letter-spacing: 0.5px;
            text-transform: uppercase;
        }

        /* éšè—åŸå§‹çš„æ–‡ä»¶è¾“å…¥æ¡† */
        input[type="file"] {
            display: none;
        }

        /* è‡ªå®šä¹‰ä¸Šä¼ æŒ‰é’® (Label) */
        .upload-area {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            border: 2px dashed #cbd5e0;
            border-radius: 8px;
            padding: 30px 20px;
            cursor: pointer;
            transition: all 0.2s ease;
            background-color: #fafbfc;
            margin-bottom: 15px;
            min-height: 120px; /* ä¿è¯é«˜åº¦ä¸€è‡´ */
        }

        .upload-area:hover {
            border-color: #3182ce;
            background-color: #ebf8ff;
        }

        /* é€‰ä¸­æ–‡ä»¶åçš„æ ·å¼ (é€šè¿‡JSæ·»åŠ è¿™ä¸ªç±») */
        .upload-area.has-file {
            border-style: solid;
            border-color: #38a169;
            background-color: #f0fff4;
        }

        .icon {
            font-size: 32px;
            margin-bottom: 10px;
        }

        .text-main {
            font-size: 1rem;
            font-weight: 600;
            color: #2d3748;
        }

        .text-sub {
            font-size: 0.8rem;
            color: #718096;
            margin-top: 4px;
        }

        /* é€‰ä¸­æ–‡ä»¶åçš„æç¤ºæ–‡å­— */
        .file-status {
            font-size: 0.9rem;
            height: 20px;
            margin-bottom: 15px;
            font-weight: 500;
        }
        .file-status.success { color: #38a169; }
        .file-status.error { color: #e53e3e; }
        .file-status.waiting { color: #718096; }

        /* --- 5. æ‰§è¡ŒæŒ‰é’®æ ·å¼ --- */
        .btn {
            width: 100%;
            padding: 12px;
            border: none;
            border-radius: 6px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: opacity 0.2s;
            color: white;
        }
        
        .btn-blue { background-color: #3182ce; }
        .btn-blue:hover { background-color: #2b6cb0; }

        .btn-green { background-color: #38a169; }
        .btn-green:hover { background-color: #2f855a; }

        .btn:disabled {
            background-color: #a0aec0;
            cursor: not-allowed;
        }

    </style>
</head>
<body>

    <div class="card">
        <h2>ğŸ› ï¸ ä¸‡èƒ½æ–‡ä»¶è½¬ .123</h2>

        <div>
            <div class="section-title">æ¨¡å¼ A: æ‰¹é‡ç‹¬ç«‹å¤„ç†</div>
            
            <label for="input-batch" class="upload-area" id="area-batch">
                <div class="icon">ğŸ“„</div>
                <div class="text-main">ç‚¹å‡»é€‰æ‹©æ–‡ä»¶</div>
                <div class="text-sub">æ”¯æŒå¤šé€‰ï¼Œä¸€å¯¹ä¸€å‹ç¼©</div>
            </label>
            <input type="file" id="input-batch" multiple onchange="uiUpdateBatch()">
            
            <div id="msg-batch" class="file-status waiting">ç­‰å¾…é€‰æ‹©...</div>
            <button id="btn-batch" class="btn btn-blue" onclick="runBatch()">â¬‡ï¸ å¼€å§‹æ‰¹é‡è½¬æ¢</button>
        </div>

        <hr class="divider">

        <div>
            <div class="section-title">æ¨¡å¼ B: æ–‡ä»¶å¤¹æ•´ä½“æ‰“åŒ…</div>
            
            <label for="input-folder" class="upload-area" id="area-folder">
                <div class="icon">ğŸ“</div>
                <div class="text-main">ç‚¹å‡»é€‰æ‹©æ–‡ä»¶å¤¹</div>
                <div class="text-sub">æ–‡ä»¶å¤¹åä¿æŒä¸å˜</div>
            </label>
            <input type="file" id="input-folder" webkitdirectory onchange="uiUpdateFolder()">
            
            <div id="msg-folder" class="file-status waiting">ç­‰å¾…é€‰æ‹©...</div>
            <button id="btn-folder" class="btn btn-green" onclick="runFolder()">â¬‡ï¸ æ‰“åŒ…æ–‡ä»¶å¤¹</button>
        </div>
    </div>

    <script>
        // --- UI æ›´æ–°é€»è¾‘ (è®©ç•Œé¢æœ‰ååº”) ---
        function uiUpdateBatch() {
            const input = document.getElementById('input-batch');
            const area = document.getElementById('area-batch');
            const msg = document.getElementById('msg-batch');
            
            if (input.files && input.files.length > 0) {
                area.classList.add('has-file');
                msg.textContent = `å·²é€‰ä¸­ ${input.files.length} ä¸ªæ–‡ä»¶`;
                msg.className = 'file-status success';
            } else {
                area.classList.remove('has-file');
                msg.textContent = 'ç­‰å¾…é€‰æ‹©...';
                msg.className = 'file-status waiting';
            }
        }

        function uiUpdateFolder() {
            const input = document.getElementById('input-folder');
            const area = document.getElementById('area-folder');
            const msg = document.getElementById('msg-folder');
            
            if (input.files && input.files.length > 0) {
                area.classList.add('has-file');
                // å°è¯•è·å–æ–‡ä»¶å¤¹åç§°
                const folderName = getFolderName(input.files);
                msg.textContent = `å·²é€‰ä¸­æ–‡ä»¶å¤¹: ${folderName}`;
                msg.className = 'file-status success';
            } else {
                area.classList.remove('has-file');
                msg.textContent = 'ç­‰å¾…é€‰æ‹©...';
                msg.className = 'file-status waiting';
            }
        }

        // --- æ ¸å¿ƒå·¥å…·å‡½æ•° ---
        
        // è·å–æ–‡ä»¶å¤¹åç§°çš„å‡†ç¡®æ–¹æ³•
        function getFolderName(files) {
            if (!files || files.length === 0) return "archive";
            // webkitRelativePath æ ¼å¼é€šå¸¸æ˜¯ "Folder/Sub/file.txt"
            const path = files[0].webkitRelativePath; 
            if (path) {
                const parts = path.split('/');
                if (parts.length > 0) return parts[0];
            }
            return "folder_archive";
        }

        // ä¸‹è½½ Blob
        function downloadBlob(blob, filename) {
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = filename;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        // --- ä¸šåŠ¡é€»è¾‘ A: æ‰¹é‡ ---
        async function runBatch() {
            const input = document.getElementById('input-batch');
            const msg = document.getElementById('msg-batch');
            const btn = document.getElementById('btn-batch');

            if (!input.files || input.files.length === 0) {
                alert("è¯·å…ˆé€‰æ‹©æ–‡ä»¶ï¼");
                return;
            }

            btn.disabled = true;
            
            try {
                for (let i = 0; i < input.files.length; i++) {
                    const file = input.files[i];
                    msg.textContent = `æ­£åœ¨å¤„ç†: ${i + 1} / ${input.files.length}`;
                    
                    const zip = new JSZip();
                    zip.file(file.name, file); // å°†æ–‡ä»¶æ”¾å…¥åŒ…å†…
                    
                    const content = await zip.generateAsync({ type: "blob" });
                    
                    // æ–‡ä»¶åå¤„ç†ï¼š image.png -> image.123
                    let baseName = file.name;
                    if (baseName.lastIndexOf('.') > 0) {
                        baseName = baseName.substring(0, baseName.lastIndexOf('.'));
                    }
                    
                    downloadBlob(content, baseName + ".123");
                    
                    // ç¼“å†²ä¸€ä¸‹ï¼Œé˜²æ­¢æµè§ˆå™¨å¡é¡¿
                    await new Promise(r => setTimeout(r, 200));
                }
                msg.textContent = "âœ… å…¨éƒ¨è½¬æ¢å®Œæˆï¼";
            } catch (err) {
                console.error(err);
                msg.textContent = "âŒ é”™è¯¯: " + err.message;
                msg.className = 'file-status error';
            } finally {
                btn.disabled = false;
            }
        }

        // --- ä¸šåŠ¡é€»è¾‘ B: æ–‡ä»¶å¤¹ ---
        async function runFolder() {
            const input = document.getElementById('input-folder');
            const msg = document.getElementById('msg-folder');
            const btn = document.getElementById('btn-folder');

            if (!input.files || input.files.length === 0) {
                alert("è¯·å…ˆé€‰æ‹©æ–‡ä»¶å¤¹ï¼");
                return;
            }

            btn.disabled = true;
            msg.textContent = "ğŸ“¦ æ­£åœ¨æ‰“åŒ…ï¼Œæ–‡ä»¶è¾ƒå¤šè¯·ç¨å€™...";

            try {
                const zip = new JSZip();
                const folderName = getFolderName(input.files);

                // éå†æ‰€æœ‰æ–‡ä»¶ï¼Œä¿æŒç»“æ„
                for (let i = 0; i < input.files.length; i++) {
                    const file = input.files[i];
                    // webkitRelativePath åŒ…å«äº†æ–‡ä»¶å¤¹ç»“æ„
                    zip.file(file.webkitRelativePath, file);
                }

                const content = await zip.generateAsync({ type: "blob" });
                
                // ä½¿ç”¨è·å–åˆ°çš„æ–‡ä»¶å¤¹å + .123
                downloadBlob(content, folderName + ".123");
                
                msg.textContent = "âœ… ä¸‹è½½å·²å¼€å§‹ï¼";
            } catch (err) {
                console.error(err);
                msg.textContent = "âŒ é”™è¯¯: " + err.message;
                msg.className = 'file-status error';
            } finally {
                btn.disabled = false;
            }
        }
    </script>
</body>
</html>